<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ADMIN VOUCHER SPIN</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background: radial-gradient(circle,#300000,#120000);
  color:white;
}

.container{
  max-width:850px;
  margin:40px auto;
  background:#4b0000;
  padding:30px;
  border-radius:20px;
  border:3px solid gold;
  box-shadow:0 0 20px gold;
}

h1{
  text-align:center;
  color:gold;
  text-shadow:0 0 10px gold;
  margin-bottom:30px;
}

.input-box{
  background:#5e0000;
  padding:25px;
  border-radius:15px;
  border:2px solid gold;
  margin-bottom:25px;
}

input, select{
  width:100%;
  padding:15px;
  margin:10px 0;
  border-radius:15px;
  border:none;
  font-size:16px;
}

button{
  padding:12px 20px;
  border:none;
  border-radius:12px;
  cursor:pointer;
  font-weight:bold;
}

.btn-create{
  background:gold;
  color:black;
}

.btn-delete{
  background:#e53935;
  color:white;
}

.table{
  margin-top:20px;
}

.row{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:12px;
  border-bottom:1px solid rgba(255,255,255,0.2);
  font-size:14px;
}

.status-ready{
  color:#00ff88;
  font-weight:bold;
}

.status-used{
  color:#ff4444;
  font-weight:bold;
}
</style>
</head>
<body>

<div class="container">

<h1>üßë‚Äçüíº ADMIN VOUCHER SPIN</h1>

<div class="input-box">
<input id="kode" placeholder="Kode Voucher (contoh: VCR123)">
<select id="hadiahSelect">
<option>Loading hadiah...</option>
</select>
<button class="btn-create" onclick="createVoucher()">BUAT VOUCHER</button>
</div>

<div class="table" id="voucherList"></div>

</div>

<script>

/* ==== FIREBASE CONFIG (PAKAI CONFIG KAMU) ==== */
firebase.initializeApp({
  apiKey:"AIzaSyDlpuf_uIlpmr2ybAqpJ2GTTRW-t86PGf0",
  authDomain:"hadiahnatal-a033b.firebaseapp.com",
  databaseURL:"https://hadiahnatal-a033b-default-rtdb.firebaseio.com",
  projectId:"hadiahnatal-a033b"
});

const db = firebase.database();

/* =========================
   LOAD HADIAH DARI RODA
=========================*/
db.ref("settings/wheelPrizes").on("value", snap => {

  const select = document.getElementById("hadiahSelect");
  select.innerHTML = "";

  if(!snap.exists()){
    select.innerHTML = "<option>Belum ada hadiah</option>";
    return;
  }

  const prizes = snap.val();

  prizes.forEach(prize => {
    select.innerHTML += `<option value="${prize}">${prize}</option>`;
  });

});

/* =========================
   BUAT VOUCHER
=========================*/
function createVoucher(){

  const kode = document.getElementById("kode").value.trim().toUpperCase();
  const hadiah = document.getElementById("hadiahSelect").value;

  if(!kode){
    alert("Masukkan kode voucher!");
    return;
  }

  db.ref("vouchers/" + kode).set({
    prize: hadiah,
    used: false,
    createdAt: new Date().toLocaleDateString("id-ID")
  });

  alert("Voucher berhasil dibuat!");
  document.getElementById("kode").value = "";

}

/* =========================
   LOAD VOUCHER
=========================*/
db.ref("vouchers").on("value", snap => {

  const list = document.getElementById("voucherList");
  list.innerHTML = "";

  snap.forEach(child => {

    const data = child.val();

    list.innerHTML += `
      <div class="row">
        <div>${child.key}</div>
        <div>${data.prize}</div>
        <div>${data.createdAt}</div>
        <div class="${data.used ? 'status-used' : 'status-ready'}">
          ${data.used ? 'USED' : 'READY'}
        </div>
        <div>
          <button class="btn-delete" onclick="deleteVoucher('${child.key}')">
            HAPUS
          </button>
        </div>
      </div>
    `;
  });

});

/* =========================
   HAPUS VOUCHER
=========================*/
function deleteVoucher(kode){

  if(confirm("Hapus voucher " + kode + "?")){
    db.ref("vouchers/" + kode).remove();
  }

}

</script>

</body>
</html>
